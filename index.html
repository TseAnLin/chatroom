<input id='selectfile' type='file' accept='text/plain' onchange='openFile(event)'>
<textarea id='output' class="notifyDetail"></textarea>
<button id='btn_save' type="submit">Save</button>

<script>
var openFile = function(event) {
  var input = event.target;
  var reader = new FileReader();      //创建一个fileReader对象
  reader.readAsText(input.files[0]);  //读取文本内容
  reader.onload = function() {
    if(reader.result) {
      //显示文件内容
      $("#output").html(reader.result);
      window.dynamicUpdate(reader.result);    //更新文本
      fileName = input.files[0].name;         //保存文件名
    }
  };
    
$(document).on("input propertychange",".notifyDetail",function(){
      window.dynamicUpdate(document.getElementById('output').value);  
  });
    
function dynamicUpdate(text){
    socket.emit('alter text', text);  
  }
    
io.on('connection',(socket) => {
    socket.on('alter text', (text) => {
      //console.log(text);
      io.emit('update text', text);
    });
  });
    
socket.on('update text', function(text){
    t.value = text;
  })
    
$('#btn_save').click(function(){
  var content = document.getElementById('output').value;
  //alert(content);
  //alert(fileName);
  if(fileName =='null'){
    alert('null');
    fileName = 'untitled.txt'
  }
  let downLink = document.createElement('a')
  downLink.download = fileName
  //字符内容转换为blod地址
  let blob = new Blob([content])
  downLink.href = URL.createObjectURL(blob)
  // 链接插入到页面
  document.body.appendChild(downLink)
  downLink.click()
  // 移除下载链接
  document.body.removeChild(downLink)
});

</script>
